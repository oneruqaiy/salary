<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>راتبي الذكي — Advanced Budget Planner</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root{
  --royal-dark:#0d1b5f;
  --royal-light:#3f51b5;
  --accent-gold:#ffb300;
  --success-green:#4caf50;
  --warning-yellow:#ffc107;
  --danger-red:#f44336;
}
body{
  background:#f4f6f9;
  font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  padding-bottom:40px;
}
.card-custom{
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,50,0.1);
  padding:20px;
  margin-bottom:20px;
  background-color:#fff;
}
.btn-royal{ background: var(--royal-dark); color:white; border:none;}
.btn-royal:hover{ background: var(--royal-light);}
.form-control:focus{ box-shadow:none; border-color: var(--royal-dark);}
.prediction-item{
  display:flex; justify-content:space-between; align-items:center; padding:8px 12px; border-radius:8px; margin-bottom:5px; cursor:pointer;
  transition: all 0.2s;
}
.prediction-item:hover{ background-color:#f1f1f1;}
.status-green{ background-color:var(--success-green); color:white;}
.status-yellow{ background-color:var(--warning-yellow); color:#000;}
.status-red{ background-color:var(--danger-red); color:white;}
.daily-details{ font-size:0.85rem; color:var(--royal-dark); margin-top:4px; display:none;}
.note{ font-size:0.86rem; color:var(--royal-dark);}
@media(max-width:768px){
  #pieChart{ height:200px !important; }
  #lineChart{ height:150px !important; }
}
</style>
</head>
<body>
<div class="container py-4">

  <!-- لوحة المصروفات اليومية -->
  <div class="card card-custom">
    <h4 class="mb-3">💰 المصروف اليومي</h4>
    <div class="row mb-2">
      <div class="col-md-4 col-12 mb-2">
        <input type="date" id="expenseDate" class="form-control" value="">
      </div>
    </div>
    <div id="expenseInputs" class="row mb-3"></div>
    <button id="addExpenseBtn" class="btn btn-royal mb-2">اضافة المصروفات</button>
    <button id="endMonthBtn" class="btn btn-warning mb-2">نهاية الشهر → تحويل الباقي للادخار</button>
    <canvas id="pieChart" class="mb-3"></canvas>
  </div>

  <!-- توقعات ونصائح الادخار -->
  <div class="card card-custom">
    <h4 class="mb-3">📊 توقعات الإنفاق ونصائح الادخار</h4>
    <div id="predictionCard"></div>
    <div id="savingTipsContainer" class="note mt-2"></div>
  </div>

  <!-- شارت المصروفات اليومية -->
  <canvas id="lineChart" class="mt-4"></canvas>

</div>

<script>
// ===== بيانات وهمية =====
const data={
  categories:{
    "ادخار":1000,
    "بترول":300,
    "استثمار":500,
    "تأمين وتجديد السيارة":400,
    "طواري":200,
    "زكاة":150,
    "ترفيه":250,
    "اكل":600
  },
  dailyExpenses:[]
};

// ===== تهيئة تاريخ اليوم =====
document.getElementById('expenseDate').value=new Date().toISOString().split('T')[0];

// ===== إدخال المصروفات =====
const expenseInputs=document.getElementById('expenseInputs');
function renderExpenseInputs(){
  expenseInputs.innerHTML="";
  for(const cat in data.categories){
    const div=document.createElement('div');
    div.className="col-md-3 col-6 mb-2";
    div.innerHTML=`<label>${cat}</label>
      <input type="number" class="form-control expense-input" placeholder="المصروف اليومي" data-cat="${cat}" data-limit="${data.categories[cat]}">`;
    expenseInputs.appendChild(div);
  }
}
renderExpenseInputs();

document.getElementById('addExpenseBtn').onclick=()=>{
  const date=document.getElementById('expenseDate').value;
  const newExpenses={}; let overLimitCats=[];
  Array.from(document.getElementsByClassName('expense-input')).forEach(inp=>{
    const cat=inp.dataset.cat;
    const limit=parseFloat(inp.dataset.limit);
    const val=parseFloat(inp.value)||0;
    newExpenses[cat]=val;
    inp.classList.remove('border-danger');
    if(val>limit){ inp.classList.add('border-danger'); overLimitCats.push(cat);}
  });
  if(overLimitCats.length>0) alert("⚠️ تجاوز الحد في الأقسام: "+overLimitCats.join(", "));
  data.dailyExpenses.push({date, expenses:newExpenses});
  renderChart(); renderPredictions(); renderSavingTips(); renderLineChart();
};

document.getElementById('endMonthBtn').onclick=()=>{
  let totalSpent=0;
  for(const day of data.dailyExpenses) for(const cat in day.expenses) totalSpent+=day.expenses[cat];
  const totalBudget=Object.values(data.categories).reduce((a,b)=>a+b,0);
  const remaining=totalBudget-totalSpent;
  alert(`تم تحويل ${remaining.toFixed(2)} ريال للادخار`);
  data.categories["ادخار"]=(data.categories["ادخار"]||0)+remaining;
  renderChart(); renderPredictions(); renderSavingTips(); renderLineChart();
};

// ===== شارت الدائرة =====
function renderChart(){
  const ctx=document.getElementById('pieChart').getContext('2d');
  const colors=Object.keys(data.categories).map(cat=>{
    const spent=data.dailyExpenses.reduce((sum,d)=>sum+(d.expenses[cat]||0),0);
    const limit=data.categories[cat]; const ratio=spent/limit;
    if(ratio<0.8) return "#4caf50";
    else if(ratio<=1) return "#ffc107";
    else return "#f44336";
  });
  const chartData={ labels:Object.keys(data.categories), datasets:[{ data:Object.values(data.categories), backgroundColor:colors }]};
  if(window.myChart) window.myChart.destroy();
  window.myChart=new Chart(ctx,{type:'pie',data:chartData, options:{responsive:true, maintainAspectRatio:false}});
}

// ===== توقعات الإنفاق =====
function renderPredictions(){
  const container=document.getElementById('predictionCard');
  container.innerHTML="";
  const today=new Date().getDate(); 
  const daysInMonth=new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate();

  for(const cat in data.categories){
    const spent=data.dailyExpenses.reduce((sum,d)=>sum+(d.expenses[cat]||0),0);
    const predicted= (data.categories[cat]-spent)/(daysInMonth-today || 1);
    const avgSpent = data.dailyExpenses.length ? spent/data.dailyExpenses.length : 0;
    let arrow="";
    if(predicted > avgSpent) arrow=" ↑"; 
    else if(predicted < avgSpent) arrow=" ↓";

    const item=document.createElement('div');
    item.className="prediction-item";

    if(predicted < 0) item.classList.add('status-red');
    else if(predicted/ data.categories[cat] <=0.2) item.classList.add('status-yellow');
    else item.classList.add('status-green');

    item.innerHTML=`<span>${cat}: المتوقع لهذا الشهر ${predicted.toFixed(2)} ريال ${arrow}</span>`;

    const dailyDiv=document.createElement('div');
    dailyDiv.className="daily-details";
    const dailyRecords=data.dailyExpenses.map(d=>`${d.date}: ${d.expenses[cat]||0} ريال`).join("<br>");
    dailyDiv.innerHTML=dailyRecords;
    item.appendChild(dailyDiv);

    item.onclick=()=>{ dailyDiv.style.display = dailyDiv.style.display==="none"?"block":"none"; }

    container.appendChild(item);
  }
}

// ===== نصائح الادخار =====
function renderSavingTips(){
  const container=document.getElementById('savingTipsContainer'); let tips=[];
  for(const cat in data.categories){
    const spent=data.dailyExpenses.reduce((sum,d)=>sum+(d.expenses[cat]||0),0);
    const limit=data.categories[cat];
    if(spent>limit) tips.push(`⚠️ قللي الإنفاق في ${cat} لتوفير أكثر`);
    else if(spent<limit*0.5) tips.push(`💡 يمكنك استثمار الفائض من ${cat} في الادخار`);
  }
  container.innerHTML=tips.length?tips.join("<br>"):"لا توجد نصائح حالياً، استمري على هذا الأداء 👍";
}

// ===== شارت الخط =====
function renderLineChart(){
  const ctx=document.getElementById('lineChart').getContext('2d');
  const labels=data.dailyExpenses.map(d=>d.date);
  const datasets=Object.keys(data.categories).map(cat=>{
    const values=data.dailyExpenses.map(d=>d.expenses[cat]||0);
    return { label:cat, data:values, borderColor:'#'+Math.floor(Math.random()*16777215).toString(16), tension:0.2, fill:false};
  });
  if(window.myLineChart) window.myLineChart.destroy();
  window.myLineChart=new Chart(ctx,{type:'line',data:{labels, datasets}, options:{responsive:true, maintainAspectRatio:false}});
}

// ===== Initial Render =====
renderChart(); renderPredictions(); renderSavingTips(); renderLineChart();
</script>
</body>
</html>
